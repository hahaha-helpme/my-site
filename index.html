<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />


    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet" />


    <!-- Chart-logica laden -->
    <script src="script/chart.js"></script>


    <!-- AG Grid + AG Charts -->
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ag-charts-community/dist/umd/ag-charts-community.js"></script>


    <style>
        html,
        body {
            margin: 0;
            padding: 0;
        }

        #myGrid {
            overflow-x: auto;
        }


        /* Stijl voor de link in de cel */
        .ag-cell.link-cell a {
            color: black;
            text-decoration: underline;
        }


        /* Stijl voor de cel die de afbeelding bevat (voor centrering) */
        .ag-cell.image-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }


        /* Stijl voor de afbeelding zelf binnen de cel */
        .ag-cell.image-cell img {
            width: 35px;
            height: 35px;
            object-fit: contain;
        }
    </style>
</head>


<body>
    <div id="myGrid" style="height: 100%; width: 100%"></div>


    <script>


        // Custom Cell Renderer voor links
        class LinkRenderer {
            init(params) {
                this.eGui = document.createElement('a');
                this.eGui.href = params.value;
                this.eGui.textContent = 'link';
                this.eGui.target = '_blank';
                // Styles verplaatst naar CSS voor een schonere scheiding van zorgen
            }
            getGui() { return this.eGui; }
            refresh(params) {
                this.eGui.href = params.value;
                this.eGui.textContent = params.value ? params.value.split('/')[2] : '';
                return true;
            }
        }


        // Custom Cell Renderer voor afbeeldingen
        class ImageRenderer {
            init(params) {
                this.eGui = document.createElement('img');
                this.eGui.alt = params.value || 'Product Image';
                this.eGui.src = params.value;
                // Styles verplaatst naar CSS voor vaste grootte en object-fit
            }
            getGui() { return this.eGui; }
            refresh(params) {
                this.eGui.alt = params.value || 'Product Image';
                this.eGui.src = params.value;
                return true;
            }
        }


        /**
         * Formats a number as a compact Euro currency string.
         * - Below 1000: two decimals (e.g. "€950,00")
         * - 1000 and above: K/M notation (e.g. "€1,4K" or "€2,3M")
         *
         * @param {number} value - The numeric value.
         * @returns {string} - The formatted Euro string.
         */
        const formatEuroCompact = (value) => {
            if (value === null || value === undefined) return ''; // Handelt null/undefined af
            const formatted = new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'EUR',
                notation: 'compact',
                compactDisplay: 'short',
                minimumFractionDigits: value < 1000 ? 2 : 0,
                maximumFractionDigits: value < 1000 ? 2 : 1
            }).format(value);


            return formatted.replace('.', ','); // Vervang punt door komma voor decimaal
        };


        /**
         * Formats a number as a Euro currency string with two decimals.
         *
         * @param {number} value - The numeric value.
         * @returns {string} - The formatted Euro string.
         */
        const formatEuro = (value) => {
            if (value === null || value === undefined) return ''; // Handelt null/undefined af
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'EUR',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            })
                .format(value)
                .replace('.', ','); // Vervang punt door komma voor decimaal
        };


        const defaultColDef = {
            cellStyle: {
                fontFamily: "Inter, sans-serif",
                fontWeight: "300",
                textAlign: "left",
                fontSize: "13px",
            },
            width: 150, // leave this because fit to content logic is failing
            resizable: true,
            editable: false,
            sortable: false,
            filter: false,
        }


        const columnTypes = {
            numericColumn: {
                cellDataType: 'number',
                filter: 'agNumberColumnFilter',
                // cellEditor: 'agNumberCellEditor',
                // cellStyle: { textAlign: 'left' }, // Lijn de *getallen in de cellen* rechts uit.
                // headerStyle: { textAlign: 'left' }, // <--- HIER LIJN JE DE *HEADER TEKST* LINKS UIT.
                // editable: true, // Numerieke kolommen zijn standaard bewerkbaar als dit type wordt gebruikt.
                // sortable: true, // Numerieke kolommen zijn sorteerbaar.
            },
            currencyColumn: {
                type: 'numericColumn', // Erft alle eigenschappen van `numericColumn`.
                valueFormatter: (params) => formatEuro(params.value), // Specifieke valuta formatter.
            },
            currencyColumnCompact: {
                type: 'numericColumn', // Erft alle eigenschappen van `numericColumn`.
                valueFormatter: (params) => formatEuroCompact(params.value), // Specifieke valuta formatter.
            },
            dateColumn: {
                cellDataType: 'dateString', // Dwingt het datatype af naar 'dateString'.
                filter: 'agDateColumnFilter', // Gebruikt de ingebouwde datumfilter.
                valueFormatter: (params) => params.value ? new Date(params.value).toLocaleDateString('nl-NL', { day: '2-digit', month: '2-digit', year: 'numeric' }) : '', // Formatteert datums en tijden.
                sortable: true, // Datumkolommen zijn sorteerbaar.
            },
            linkColumn: {
                cellRenderer: 'LinkRenderer',
                cellClass: 'link-cell',
            },
            imageColumn: {
                cellRenderer: 'ImageRenderer', // Gebruikt de custom ImageRenderer.
                cellClass: "image-cell", // CSS-klasse voor centreren van inhoud.
            },
        };


        const theme = agGrid.themeQuartz
            .withPart(agGrid.iconSetMaterial)
            .withParams({
                accentColor: "#000",
                borderColor: "#03020226",
                borderRadius: 4,
                browserColorScheme: "light",
                fontFamily: { googleFont: "Inter" },
                foregroundColor: "#000",
                headerBackgroundColor: "#FFF",
                headerFontSize: 13,
                headerRowBorder: { width: 1, style: "solid", color: "#e4e8ed" },
                iconSize: 13,
                rowHeight: 57,
                rowBorder: { width: 1, style: "solid", color: "#e4e8ed" },
                wrapperBorder: false,
                cellTextColor: "#343433",
                headerTextColor: "#343433",
                wrapperBorderRadius: 0,
                headerColumnResizeHandleColor: "transparent",
                spacing: 8,
                oddRowBackgroundColor: "#FDFCFC",
            });

            console.log('test1')
        const gridOptions = {
            theme,
            defaultColDef,
            columnTypes,
            pagination: true,
            paginationPageSize: 10,
            paginationPageSizeSelector: [10],
            animateRows: true,
            suppressCellFocus: true,
            undoRedoCellEditing: false,
            undoRedoCellEditingLimit: 5,
            domLayout: "autoHeight",
            // groupDisplayType: "multipleColumns",
              selectionColumnDef: {
    headerName: 'Track',     // tekst boven de check­boxen
    width: 80,
    headerCheckboxSelection: true  // optioneel: “select-all”
  },
            loadThemeGoogleFonts: true,
            suppressHorizontalScroll: true,
            rowSelection: 'multiple',
            rowMultiSelectWithClick: true,
            suppressRowClickSelection: true,
            components: {
                LinkRenderer: LinkRenderer,
                ImageRenderer: ImageRenderer,
            },
            onRowClicked: (event) => {
                showStockChart(event.data.offers, event.node);
            },
        };


        let gridApi = agGrid.createGrid(document.querySelector("#myGrid"), gridOptions);

        window.onmessage = ({ origin, data }) => {
            if (origin === "https://www-sellerrr-com.filesusr.com" && data.action === "updateGrid") {
                if (data.payload.rowData) gridApi.setGridOption("rowData", data.payload.rowData);
                if (data.payload.columnDefs) gridApi.setGridOption("columnDefs", data.payload.columnDefs);
                window.parent.postMessage({ action: "gridUpdated", status: "success" }, origin);
            }
        };
        

        // /* Iframe → GitHub */
        // window.addEventListener("message", (e) => {
        //     if (e.origin !== "https://www-sellerrr-com.filesusr.com") return;
        //     const { action, payload } = e.data;
        //     if (action === "updateGrid") {
        //         console.log("✅ reply van Html:", e);
        //         // hier grid opbouwen…
        //     }
        // });

        // /* GitHub → Iframe */
        // window.parent.postMessage(
        //     { action: "gridUpdated", status: "ok" },
        //     "https://www-sellerrr-com.filesusr.com"
        // );

        const el = document.querySelector('.ag-center-cols-viewport');
        el?.addEventListener('wheel', (e) => {
            if (!e.shiftKey && e.deltaY) {
                el.scrollLeft += e.deltaY;
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>

</html>