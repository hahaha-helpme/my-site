<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />


    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet" />


    <!-- LinkRenderer: cellRenderer voor hyperlink-kolommen -->
    <script src="script/link-renderer.js"></script>

    <!-- ImageRenderer: cellRenderer voor afbeelding-kolommen -->
    <script src="script/image-renderer.js"></script>

    <!-- formatEuroCompact() : compacte â‚¬-notatie (K / M) -->
    <script src="script/format-euro-compact.js"></script>

    <!-- formatEuro() : standaard â‚¬-notatie met twee decimalen -->
    <script src="script/format-euro.js"></script>

    <!-- showStockChart() : Chart-logica -->
    <script src="script/chart.js"></script>


    <!-- AG Grid + AG Charts -->
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ag-charts-community/dist/umd/ag-charts-community.js"></script>


    <style>
        html,
        body {
            margin: 0;
            padding: 0;
        }

        #myGrid {
            overflow-x: auto;
        }


        /* Stijl voor de link in de cel */
        .ag-cell.link-cell a {
            color: black;
            text-decoration: underline;
        }


        /* Stijl voor de cel die de afbeelding bevat (voor centrering) */
        .ag-cell.image-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }


        /* Stijl voor de afbeelding zelf binnen de cel */
        .ag-cell.image-cell img {
            width: 35px;
            height: 35px;
            object-fit: contain;
        }
    </style>
</head>


<body>
    <div id="myGrid" style="height: 100%; width: 100%"></div>


    <script>

        const defaultColDef = {
            cellStyle: {
                fontFamily: "Inter, sans-serif",
                fontWeight: "300",
                textAlign: "left",
                fontSize: "13px",
            },
            width: 150, // leave this because fit to content logic is failing
            resizable: true,
            editable: false,
            sortable: false,
            filter: false,
        }


        const columnTypes = {
            numericColumn: {
                cellDataType: 'number',
                filter: 'agNumberColumnFilter',
                // cellEditor: 'agNumberCellEditor',
                // cellStyle: { textAlign: 'left' }, // Lijn de *getallen in de cellen* rechts uit.
                // headerStyle: { textAlign: 'left' }, // <--- HIER LIJN JE DE *HEADER TEKST* LINKS UIT.
                // editable: true, // Numerieke kolommen zijn standaard bewerkbaar als dit type wordt gebruikt.
                // sortable: true, // Numerieke kolommen zijn sorteerbaar.
            },
            currencyColumn: {
                type: 'numericColumn', // Erft alle eigenschappen van `numericColumn`.
                valueFormatter: (params) => formatEuro(params.value), // Specifieke valuta formatter.
            },
            currencyColumnCompact: {
                type: 'numericColumn', // Erft alle eigenschappen van `numericColumn`.
                valueFormatter: (params) => formatEuroCompact(params.value), // Specifieke valuta formatter.
            },
            dateColumn: {
                cellDataType: 'dateString', // Dwingt het datatype af naar 'dateString'.
                filter: 'agDateColumnFilter', // Gebruikt de ingebouwde datumfilter.
                valueFormatter: (params) => params.value ? new Date(params.value).toLocaleDateString('nl-NL', { day: '2-digit', month: '2-digit', year: 'numeric' }) : '', // Formatteert datums en tijden.
                sortable: true, // Datumkolommen zijn sorteerbaar.
            },
            linkColumn: {
                cellRenderer: 'LinkRenderer',
                cellClass: 'link-cell',
            },
            imageColumn: {
                cellRenderer: 'ImageRenderer', // Gebruikt de custom ImageRenderer.
                cellClass: "image-cell", // CSS-klasse voor centreren van inhoud.
            },
        };


        const theme = agGrid.themeQuartz
            .withPart(agGrid.iconSetMaterial)
            .withParams({
                accentColor: "#000",
                browserColorScheme: "light",
                fontFamily: { googleFont: "Inter" },
                foregroundColor: "#000",
                headerBackgroundColor: "#FFF",
                headerFontSize: 13,
                headerRowBorder: { width: 1, style: "solid", color: "#e4e8ed" },
                iconSize: 13,
                rowHeight: 57,
                rowBorder: { width: 1, style: "solid", color: "#e4e8ed" },
                wrapperBorder: false,
                cellTextColor: "#343433",
                headerTextColor: "#343433",
                wrapperBorderRadius: 0,
                headerColumnResizeHandleColor: "transparent",
                spacing: 8,
                oddRowBackgroundColor: "#FDFCFC",
            });


                // ---- helpers --------------------------------------------------------------
                const eventParsers = {
                filter:          e => ({ action: 'filterChanged',           payload: e.api.getFilterModel() }),
                sort:            e => ({ action: 'sortChanged',             payload: e.api.getSortModel()   }),
                columnMove:      e => ({ action: 'columnMoved',             payload: e.columnApi.getColumnState() }),
                columnResize:    e => ({ action: 'columnResized',           payload: { colId: e.column.getColId(), width: e.column.getActualWidth() } }),
                columnVisible:   e => ({ action: 'columnVisibilityChanged', payload: { colId: e.column.getColId(), visible: e.column.visible } }),
                columnPinned:    e => ({ action: 'columnPinnedChanged',     payload: { colId: e.column.getColId(), pinned: e.column.pinned } }),
                cellValueChanged:e => ({ action: 'gridRowUpdated',          payload: e.data }),
                selectionChanged:e => ({ action: 'gridSelectionChanged',    payload: e.api.getSelectedRows() }),
                rowClicked:      e => ({ action: 'rowClicked',              payload: e.data }),
                rowDoubleClicked:e => ({ action: 'rowDoubleClicked',        payload: e.data }),
                rowGroupOpened:  e => ({ action: 'gridRowGroupChanged',     payload: { nodeId: e.node.id, expanded: e.node.expanded } }),
                paginationChanged:e =>({ action: 'gridPaginationChanged',   payload: { currentPage: e.api.paginationGetCurrentPage(), totalPages: e.api.paginationGetTotalPages() } })
                };

                // ---- universele dispatcher -----------------------------------------------
                function handleGridEvent(event, type) {
                const parser = eventParsers[type];          // pak de juiste parser
                if (!parser) return console.warn('ðŸ’¡ onbekend event-type:', type);
                const { action, payload } = parser(event);  // vorm het bericht
                window.parent.postMessage({ action, payload, type }, "https://www-sellerrr-com.filesusr.com");
                }

        const gridOptions = {
            theme,
            defaultColDef,
            columnTypes,
            pagination: true,
            paginationPageSize: 10,
            paginationPageSizeSelector: [10],
            animateRows: true,
            suppressCellFocus: true,
            undoRedoCellEditing: false,
            undoRedoCellEditingLimit: 5,
            domLayout: "autoHeight",
            loadThemeGoogleFonts: true,
            suppressHorizontalScroll: true,
            rowMultiSelectWithClick: true,
            components: {
                LinkRenderer: LinkRenderer,
                ImageRenderer: ImageRenderer,
            },
            // onRowClicked: (event) => {
            //     showStockChart(event.data.offers, event.node);
            // },

            onFilterChanged: (event) => handleGridEvent(event, 'filter'),
            onSortChanged: (event) => handleGridEvent(event, 'sort'),
            onColumnMoved: (event) => handleGridEvent(event, 'columnMove'),
            onColumnResized: (event) => handleGridEvent(event, 'columnResize'),
            onColumnVisible: (event) => handleGridEvent(event, 'columnVisible'),
            onColumnPinned: (event) => handleGridEvent(event, 'columnPinned'),
            onCellValueChanged: (event) => handleGridEvent(event, 'cellValueChanged'),
            onSelectionChanged: (event) => handleGridEvent(event, 'selectionChanged'),
            onPaginationChanged: (event) => handleGridEvent(event, 'paginationChanged'),
            onRowGroupOpened: (event) => handleGridEvent(event, 'rowGroupOpened'),
            onRowDoubleClicked: (event) => handleGridEvent(event, 'rowDoubleClicked'),
            onRowClicked: (event) => { handleGridEvent(event, 'rowClicked') },

        };

        let gridApi = agGrid.createGrid(document.querySelector("#myGrid"), gridOptions);
        
        /* Iframe â†’ GitHub */
        window.addEventListener("message", (e) => {
            if (e.origin !== "https://www-sellerrr-com.filesusr.com") return;
            const { action, payload } = e.data;
            if (action === "updateGrid") {
                if (payload.rowData) gridApi.setGridOption("rowData", payload.rowData);
                if (payload.columnDefs) gridApi.setGridOption("columnDefs", payload.columnDefs);
            }
        });

        // /* GitHub â†’ Iframe */
        // window.parent.postMessage({ action: "gridUpdated", status: "ok" }, "https://www-sellerrr-com.filesusr.com" );



        const el = document.querySelector('.ag-center-cols-viewport');
        el?.addEventListener('wheel', (e) => {
            if (!e.shiftKey && e.deltaY) {
                el.scrollLeft += e.deltaY;
                e.preventDefault();
            }
        }, { passive: false });



    </script>
</body>

</html>